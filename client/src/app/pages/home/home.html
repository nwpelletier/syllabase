<div [class.isDark]="themeService.isDark">
  <h2>Piece Details</h2>
  <table>
    <thead>
      <tr>
        <th>Piece</th>
        <th>Composer</th>
        <th>Collection</th>
        <th>Syllabus</th>
        <th>Grade</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of piecesWithDetails">
        <td>{{ item.pieceName }}</td>
        <td>{{ item.composer }}</td>
        <td>{{ item.collection || '-' }}</td>
        <td>{{ item.syllabus || '-' }}</td>
        <td>{{ item.grade || '-' }}</td>
      </tr>
    </tbody>
  </table>

  <!-- Add Piece Form -->
  <h2>Add a new piece</h2>
  <form (ngSubmit)="addPiece()">
    <label>
      Piece Name:
      <input type="text" [(ngModel)]="pieceName" name="pieceNameAdd" />
    </label>

    <label>
      Composer:
      <select [(ngModel)]="selectedComposerId" name="composerSelectAdd">
        <option [ngValue]="null">-- Select Composer --</option>
        <option *ngFor="let composer of composers" [ngValue]="composer.id">
          {{ composer.firstName }} {{ composer.lastName }}
        </option>
      </select>
    </label>

    <button type="submit" [disabled]="!isFormValid">Add Piece</button>
  </form>

  <!-- Add Composer Form -->
  <h2>Add a new composer</h2>
  <form (ngSubmit)="addComposer()">
    <input
      type="text"
      placeholder="First Name"
      [(ngModel)]="newComposer.firstName"
      name="newComposerFirstName"
      required
    />
    <input
      type="text"
      placeholder="Last Name"
      [(ngModel)]="newComposer.lastName"
      name="newComposerLastName"
      required
    />
    <input
      type="number"
      placeholder="Birth Year"
      [(ngModel)]="newComposer.birthYear"
      name="newComposerBirthYear"
      required
    />
    <input
      type="number"
      placeholder="Death Year"
      [(ngModel)]="newComposer.deathYear"
      name="newComposerDeathYear"
    />
    <input
      type="text"
      placeholder="Nationality"
      [(ngModel)]="newComposer.nationality"
      name="newComposerNationality"
      required
    />
    <button type="submit">Add Composer</button>
  </form>

  <!-- Add Collection Form -->
  <h2>Add a new Collection</h2>
  <form (ngSubmit)="addCollection()">
    <input
      type="text"
      placeholder="Collection Name"
      [(ngModel)]="newCollection.name"
      name="collectionName"
      required
    />
    <select [(ngModel)]="newCollection.composerId" name="collectionComposer" required>
      <option [ngValue]="null">-- Select Composer --</option>
      <option *ngFor="let composer of composers" [ngValue]="composer.id">
        {{ composer.firstName }} {{ composer.lastName }}
      </option>
    </select>
    <button type="submit">Add Collection</button>
  </form>

  <!-- Add Piece to Syllabus Form -->
  <h2>Add Piece to Syllabus</h2>
  <form (ngSubmit)="addPieceSyllabus()">
    <label>
      Composer:
      <select
        [(ngModel)]="selectedComposerIdForPieceSyllabus"
        name="composerForPieceSyllabus"
        (ngModelChange)="onComposerChange()"
      >
        <option [ngValue]="null">-- Select Composer --</option>
        <option *ngFor="let composer of composers" [ngValue]="composer.id">
          {{ composer.firstName }} {{ composer.lastName }}
        </option>
      </select>
    </label>

    <label>
      Piece:
      <select [(ngModel)]="newPieceSyllabus.pieceId" name="pieceForSyllabus">
        <option [ngValue]="null">-- Select Piece --</option>
        <option *ngFor="let piece of filteredPieces" [ngValue]="piece.id">{{ piece.name }}</option>
      </select>
    </label>

    <label>
      Collection (optional):
      <select [(ngModel)]="newPieceSyllabus.collectionId" name="collectionForSyllabus">
        <option [ngValue]="null">-- None --</option>
        <option *ngFor="let collection of filteredCollections" [ngValue]="collection.id">
          {{ collection.name }}
        </option>
      </select>
    </label>

    <label>
      Syllabus:
      <select
        [(ngModel)]="newPieceSyllabus.syllabusId"
        name="syllabusForSyllabus"
        (ngModelChange)="onSyllabusChange()"
      >
        <option [ngValue]="null">-- Select Syllabus --</option>
        <option *ngFor="let syllabus of syllabi" [ngValue]="syllabus.id">
          {{ syllabus.name }}
        </option>
      </select>
    </label>

    <label>
      Grade:
      <select [(ngModel)]="newPieceSyllabus.gradeId" name="gradeForSyllabus">
        <option [ngValue]="null">-- Select Grade --</option>
        <option *ngFor="let grade of filteredGrades" [ngValue]="grade.id">
          {{ grade.grade }}
        </option>
      </select>
    </label>
    <button type="submit" [disabled]="!isPieceSyllabusFormValid">Add Piece</button>
  </form>
</div>
